name: "CI"

concurrency:
  cancel-in-progress: true
  group: ${{ github.ref }}

on:
  push:
    branches: ["main"]
  pull_request:
  workflow_dispatch:

jobs:
  ci:
    runs-on: ubuntu-latest
    steps:
      - name: Set up devkit
        uses: sablier-labs/devkit/actions/setup@v1
        with:
          package-manager: bun

      - name: Install qsv
        run: |
          wget -O - https://dathere.github.io/qsv-deb-releases/qsv-deb.gpg | sudo gpg --dearmor -o /usr/share/keyrings/qsv-deb.gpg
          echo "deb [signed-by=/usr/share/keyrings/qsv-deb.gpg] https://dathere.github.io/qsv-deb-releases ./" | sudo tee /etc/apt/sources.list.d/qsv.list
          sudo apt update
          sudo apt install qsv

      - name: Run code checks
        run: |
          just full-check
          just tsv-check

      - name: Add summary
        run: | #shell
          echo "## CI result" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Passed" >> $GITHUB_STEP_SUMMARY
